{
  "name": "referral",
  "remarks": [
    "CABG Referral."
  ],
  "states": {
    "Initial": {
      "type": "Initial",
      "direct_transition": "Set Consultation Count"
    },
    "Terminal": {
      "type": "Terminal"
    },
    "Consultation": {
      "type": "Procedure",
      "codes": [
        {
          "system": "SNOMED-CT",
          "code": 698314001,
          "display": "Consultation for treatment (procedure)"
        }
      ],
      "duration": {
        "low": 30,
        "high": 60,
        "unit": "minutes"
      },
      "direct_transition": "Diagnostic",
      "reason": "cardiac_surgery_reason"
    },
    "Diagnostic": {
      "type": "Procedure",
      "codes": [
        {
          "system": "SNOMED-CT",
          "code": 77343006,
          "display": "Angiography (procedure)"
        }
      ],
      "duration": {
        "low": 30,
        "high": 60,
        "unit": "minutes"
      },
      "direct_transition": "Abnormal Findings",
      "reason": "cardiac_surgery_reason"
    },
    "End Referral Consultation": {
      "type": "EncounterEnd",
      "direct_transition": "Wait for Appointment"
    },
    "Referral Procedure 2": {
      "type": "Procedure",
      "codes": [
        {
          "system": "SNOMED-CT",
          "code": 183557002,
          "display": "Referral to cardiothoracic surgeon (procedure)"
        }
      ],
      "duration": {
        "low": 30,
        "high": 60,
        "unit": "minutes"
      },
      "direct_transition": "Preoperative Testing",
      "reason": "Abnormal Findings"
    },
    "End CABG Postop": {
      "type": "EncounterEnd",
      "direct_transition": "Terminal"
    },
    "Recovery": {
      "type": "Delay",
      "direct_transition": "End CABG Postop",
      "range": {
        "low": 1,
        "high": 5,
        "unit": "days"
      }
    },
    "CABG Surgery": {
      "type": "Encounter",
      "encounter_class": "inpatient",
      "reason": "Abnormal Findings",
      "codes": [
        {
          "system": "SNOMED-CT",
          "code": 185347001,
          "display": "Encounter for problem (procedure)"
        }
      ],
      "direct_transition": "Emergency Check"
    },
    "CABG_Postop": {
      "type": "Encounter",
      "encounter_class": "inpatient",
      "reason": "History of CABG",
      "codes": [
        {
          "system": "SNOMED-CT",
          "code": 390906007,
          "display": "Follow-up encounter (procedure)"
        }
      ],
      "direct_transition": "Recovery"
    },
    "Finish Surgery": {
      "type": "EncounterEnd",
      "direct_transition": "CABG_Postop"
    },
    "CABG": {
      "type": "Procedure",
      "codes": [
        {
          "system": "SNOMED-CT",
          "code": 232717009,
          "display": "Coronary artery bypass grafting (procedure)"
        }
      ],
      "duration": {
        "low": 30,
        "high": 120,
        "unit": "minutes"
      },
      "direct_transition": "History of CABG",
      "reason": "Abnormal Findings"
    },
    "Emergency CABG": {
      "type": "Procedure",
      "codes": [
        {
          "system": "SNOMED-CT",
          "code": 414088005,
          "display": "Emergency coronary artery bypass graft (procedure)"
        }
      ],
      "duration": {
        "low": 30,
        "high": 120,
        "unit": "minutes"
      },
      "direct_transition": "History of CABG",
      "reason": "Abnormal Findings"
    },
    "Cardiology Consultation": {
      "type": "Encounter",
      "encounter_class": "ambulatory",
      "reason": "cardiac_surgery_reason",
      "codes": [
        {
          "system": "SNOMED-CT",
          "code": 185347001,
          "display": "Encounter for problem (procedure)"
        }
      ],
      "direct_transition": "Consultation"
    },
    "New_State": {
      "type": "ConditionOnset",
      "assign_to_attribute": "",
      "target_encounter": "",
      "codes": [
        {
          "system": "SNOMED-CT",
          "code": "1234",
          "display": "SNOMED Code"
        }
      ],
      "direct_transition": "New_State"
    },
    "Abnormal Findings": {
      "type": "ConditionOnset",
      "assign_to_attribute": "",
      "codes": [
        {
          "system": "SNOMED-CT",
          "code": 274531002,
          "display": "Abnormal findings diagnostic imaging heart+coronary circulat (finding)"
        }
      ],
      "complex_transition": [
        {
          "condition": {
            "condition_type": "Attribute",
            "attribute": "cabg_consultation_count",
            "operator": ">",
            "value": 0
          },
          "distributions": [],
          "transition": "Referral to Surgery"
        },
        {
          "distributions": [
            {
              "transition": "Referral to Surgery",
              "distribution": 0.35
            },
            {
              "transition": "Referral to Service",
              "distribution": 0.15
            },
            {
              "transition": "Repeat Referral",
              "distribution": 0.5
            }
          ]
        }
      ]
    },
    "Set Consultation Count": {
      "type": "SetAttribute",
      "attribute": "cabg_consultation_count",
      "direct_transition": "Cardiology Consultation",
      "value": 0
    },
    "Referral to Surgery": {
      "type": "Procedure",
      "codes": [
        {
          "system": "SNOMED-CT",
          "code": 306185001,
          "display": "Referral to cardiac surgery service (procedure)"
        }
      ],
      "duration": {
        "low": 30,
        "high": 60,
        "unit": "minutes"
      },
      "reason": "Abnormal Findings",
      "complex_transition": [
        {
          "condition": {
            "condition_type": "Attribute",
            "attribute": "cabg_consultation_count",
            "operator": ">",
            "value": 0
          },
          "distributions": [],
          "transition": "End_Referral_Consultation"
        },
        {
          "distributions": [
            {
              "transition": "End_Referral_Consultation",
              "distribution": 0.99
            },
            {
              "transition": "Referral to Service",
              "distribution": 0.01
            }
          ]
        }
      ]
    },
    "Referral to Service": {
      "type": "Procedure",
      "codes": [
        {
          "system": "SNOMED-CT",
          "code": 306206005,
          "display": "Referral to service (procedure)"
        }
      ],
      "duration": {
        "low": 30,
        "high": 60,
        "unit": "minutes"
      },
      "reason": "Abnormal Findings",
      "distributed_transition": [
        {
          "transition": "Referral to Surgery",
          "distribution": 0.5
        },
        {
          "transition": "Repeat Referral",
          "distribution": 0.5
        }
      ]
    },
    "Repeat Referral": {
      "type": "Procedure",
      "codes": [
        {
          "system": "SNOMED-CT",
          "code": 183519002,
          "display": "Referral to cardiology service (procedure)"
        }
      ],
      "duration": {
        "low": 30,
        "high": 60,
        "unit": "minutes"
      },
      "reason": "Abnormal Findings",
      "direct_transition": "End Referral Consultation"
    },
    "Wait for Appointment": {
      "type": "Delay",
      "direct_transition": "Count",
      "range": {
        "low": 1,
        "high": 7,
        "unit": "days"
      }
    },
    "Count": {
      "type": "Counter",
      "attribute": "cabg_consultation_count",
      "action": "increment",
      "direct_transition": "Cardiology Consultation"
    },
    "End_Referral_Consultation": {
      "type": "EncounterEnd",
      "conditional_transition": [
        {
          "transition": "Priority 1 Next Encounter",
          "condition": {
            "condition_type": "Attribute",
            "attribute": "care_priority_level",
            "operator": "==",
            "value": 1
          }
        },
        {
          "transition": "Priority 2 Next Encounter",
          "condition": {
            "condition_type": "Attribute",
            "attribute": "care_priority_level",
            "operator": "==",
            "value": 2
          }
        },
        {
          "transition": "Priority 3 Next Encounter",
          "condition": {
            "condition_type": "Attribute",
            "attribute": "care_priority_level",
            "operator": "==",
            "value": 3
          }
        },
        {
          "transition": "Priority 4 Next_Encounter"
        }
      ]
    },
    "Priority 1 Next Encounter": {
      "type": "Delay",
      "direct_transition": "Set Immediate Admission",
      "range": {
        "low": 0,
        "high": 48,
        "unit": "hours"
      }
    },
    "Priority 2 Next Encounter": {
      "type": "Delay",
      "range": {
        "low": 1,
        "high": 7,
        "unit": "days"
      },
      "distributed_transition": [
        {
          "transition": "Preoperative Outpatient",
          "distribution": 0.5
        },
        {
          "transition": "Set Immediate Admission",
          "distribution": 0.5
        }
      ]
    },
    "Priority 3 Next Encounter": {
      "type": "Delay",
      "direct_transition": "Preoperative Outpatient",
      "range": {
        "low": 7,
        "high": 21,
        "unit": "days"
      }
    },
    "Priority 4 Next_Encounter": {
      "type": "Delay",
      "range": {
        "low": 21,
        "high": 45,
        "unit": "days"
      },
      "direct_transition": "Preoperative Outpatient"
    },
    "Immediate Surgical Admission": {
      "type": "Encounter",
      "encounter_class": "inpatient",
      "reason": "Abnormal Findings",
      "codes": [
        {
          "system": "SNOMED-CT",
          "code": 112802009,
          "display": "Cardiovascular operative procedure (procedure)"
        }
      ],
      "direct_transition": "Referral Procedure 2"
    },
    "Preoperative Outpatient": {
      "type": "Encounter",
      "encounter_class": "ambulatory",
      "reason": "Abnormal Findings",
      "codes": [
        {
          "system": "SNOMED-CT",
          "code": 390906007,
          "display": "Follow-up encounter (procedure)"
        }
      ],
      "direct_transition": "Referral Procedure 2"
    },
    "Preoperative Testing": {
      "type": "CallSubmodule",
      "submodule": "heart/cabg/preoperative",
      "conditional_transition": [
        {
          "transition": "Emergency Check",
          "condition": {
            "condition_type": "Attribute",
            "attribute": "cabg_immediate_admission",
            "operator": "==",
            "value": true
          }
        },
        {
          "transition": "End Preoperative"
        }
      ]
    },
    "End Preoperative": {
      "type": "EncounterEnd",
      "conditional_transition": [
        {
          "transition": "Priority_2_Next_Encounter",
          "condition": {
            "condition_type": "Attribute",
            "attribute": "care_priority_level",
            "operator": "==",
            "value": 2
          }
        },
        {
          "transition": "Priority_3_Next_Encounter",
          "condition": {
            "condition_type": "Attribute",
            "attribute": "care_priority_level",
            "operator": "==",
            "value": 3
          }
        },
        {
          "transition": "Priority_4_Next_Encounter",
          "condition": {
            "condition_type": "Attribute",
            "attribute": "care_priority_level",
            "operator": "==",
            "value": 4
          }
        }
      ]
    },
    "Set Immediate Admission": {
      "type": "SetAttribute",
      "attribute": "cabg_immediate_admission",
      "direct_transition": "Immediate Surgical Admission",
      "value": true
    },
    "Priority_2_Next_Encounter": {
      "type": "Delay",
      "range": {
        "low": 1,
        "high": 7,
        "unit": "days"
      },
      "direct_transition": "CABG Surgery"
    },
    "Priority_3_Next_Encounter": {
      "type": "Delay",
      "range": {
        "low": 7,
        "high": 21,
        "unit": "days"
      },
      "direct_transition": "CABG Surgery"
    },
    "Priority_4_Next_Encounter": {
      "type": "Delay",
      "range": {
        "low": 21,
        "high": 45,
        "unit": "days"
      },
      "direct_transition": "CABG Surgery"
    },
    "Emergency Check": {
      "type": "Simple",
      "conditional_transition": [
        {
          "transition": "Emergency CABG",
          "condition": {
            "condition_type": "Attribute",
            "attribute": "care_score_e",
            "operator": "==",
            "value": true
          }
        },
        {
          "transition": "CABG"
        }
      ]
    },
    "History of CABG": {
      "type": "ConditionOnset",
      "assign_to_attribute": "cabg_history",
      "codes": [
        {
          "system": "SNOMED-CT",
          "code": 399261000,
          "display": "History of coronary artery bypass grafting (situation)"
        }
      ],
      "direct_transition": "Finish Surgery"
    }
  }
}