{
  "name": "cardiac_surgery",
  "remarks": [
    "Cardiac Surgery Module"
  ],
  "states": {
    "Initial": {
      "type": "Initial",
      "direct_transition": "Block Pediatric Patients"
    },
    "Terminal": {
      "type": "Terminal"
    },
    "Wait Until High Risk": {
      "type": "Guard",
      "allow": {
        "condition_type": "Or",
        "conditions": [
          {
            "condition_type": "Attribute",
            "attribute": "atrial_fibrillation",
            "operator": "==",
            "value": true
          },
          {
            "condition_type": "Or",
            "conditions": [
              {
                "condition_type": "Active Condition",
                "codes": [
                  {
                    "system": "SNOMED-CT",
                    "code": 410429000,
                    "display": "Cardiac Arrest"
                  }
                ]
              },
              {
                "condition_type": "Or",
                "conditions": [
                  {
                    "condition_type": "Attribute",
                    "attribute": "stroke_history",
                    "operator": "==",
                    "value": true
                  },
                  {
                    "condition_type": "Or",
                    "conditions": [
                      {
                        "condition_type": "Attribute",
                        "attribute": "ckd",
                        "operator": ">=",
                        "value": 4
                      },
                      {
                        "condition_type": "Or",
                        "conditions": [
                          {
                            "condition_type": "Attribute",
                            "attribute": "chf",
                            "operator": "is not nil"
                          },
                          {
                            "condition_type": "Or",
                            "conditions": [
                              {
                                "condition_type": "Attribute",
                                "attribute": "copd_variant",
                                "operator": "is not nil"
                              },
                              {
                                "condition_type": "Or",
                                "conditions": [
                                  {
                                    "condition_type": "Attribute",
                                    "attribute": "hypertension",
                                    "operator": "is not nil"
                                  },
                                  {
                                    "condition_type": "Or",
                                    "conditions": [
                                      {
                                        "condition_type": "Attribute",
                                        "attribute": "smoking",
                                        "operator": "==",
                                        "value": true
                                      },
                                      {
                                        "condition_type": "Or",
                                        "conditions": [
                                          {
                                            "condition_type": "Attribute",
                                            "attribute": "smoker",
                                            "operator": "==",
                                            "value": true
                                          },
                                          {
                                            "condition_type": "Or",
                                            "conditions": [
                                              {
                                                "condition_type": "Attribute",
                                                "attribute": "coronary_heart_disease",
                                                "operator": "is not nil"
                                              },
                                              {
                                                "condition_type": "Or",
                                                "conditions": [
                                                  {
                                                    "condition_type": "Attribute",
                                                    "attribute": "diabetes",
                                                    "operator": "is not nil"
                                                  },
                                                  {
                                                    "condition_type": "Or",
                                                    "conditions": [
                                                      {
                                                        "condition_type": "Attribute",
                                                        "attribute": "metabolic_syndrome",
                                                        "operator": "is not nil"
                                                      },
                                                      {
                                                        "condition_type": "Or",
                                                        "conditions": [
                                                          {
                                                            "condition_type": "Vital Sign",
                                                            "vital_sign": "BMI",
                                                            "operator": ">=",
                                                            "value": 25
                                                          },
                                                          {
                                                            "condition_type": "Or",
                                                            "conditions": [
                                                              {
                                                                "condition_type": "Active Condition",
                                                                "codes": [
                                                                  {
                                                                    "system": "SNOMED-CT",
                                                                    "code": 22298006,
                                                                    "display": "Myocardial Infarction"
                                                                  }
                                                                ]
                                                              },
                                                              {
                                                                "condition_type": "Or",
                                                                "conditions": [
                                                                  {
                                                                    "condition_type": "Active Condition",
                                                                    "codes": [
                                                                      {
                                                                        "system": "SNOMED-CT",
                                                                        "code": 27942005,
                                                                        "display": "Shock (disorder)"
                                                                      }
                                                                    ]
                                                                  },
                                                                  {
                                                                    "condition_type": "Or",
                                                                    "conditions": [
                                                                      {
                                                                        "condition_type": "Active Condition",
                                                                        "codes": [
                                                                          {
                                                                            "system": "SNOMED-CT",
                                                                            "code": 55822004,
                                                                            "display": "Hyperlipidemia"
                                                                          }
                                                                        ]
                                                                      },
                                                                      {
                                                                        "condition_type": "Or",
                                                                        "conditions": [
                                                                          {
                                                                            "condition_type": "And",
                                                                            "conditions": [
                                                                              {
                                                                                "condition_type": "Gender",
                                                                                "gender": "M"
                                                                              },
                                                                              {
                                                                                "condition_type": "Age",
                                                                                "operator": ">=",
                                                                                "quantity": 55,
                                                                                "unit": "years"
                                                                              }
                                                                            ]
                                                                          },
                                                                          {
                                                                            "condition_type": "And",
                                                                            "conditions": [
                                                                              {
                                                                                "condition_type": "Gender",
                                                                                "gender": "F"
                                                                              },
                                                                              {
                                                                                "condition_type": "Age",
                                                                                "operator": ">=",
                                                                                "quantity": 65,
                                                                                "unit": "years"
                                                                              }
                                                                            ]
                                                                          }
                                                                        ]
                                                                      }
                                                                    ]
                                                                  }
                                                                ]
                                                              }
                                                            ]
                                                          }
                                                        ]
                                                      }
                                                    ]
                                                  }
                                                ]
                                              }
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                ]
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                ]
              }
            ]
          }
        ]
      },
      "conditional_transition": [
        {
          "transition": "Reason",
          "condition": {
            "condition_type": "Attribute",
            "attribute": "cardiac_surgery_reason",
            "operator": "is nil"
          }
        },
        {
          "transition": "Cardiac Encounter"
        }
      ]
    },
    "Block Pediatric Patients": {
      "type": "Guard",
      "allow": {
        "condition_type": "Age",
        "operator": ">",
        "quantity": 18,
        "unit": "years"
      },
      "direct_transition": "Wait Until High Risk"
    },
    "CABG": {
      "type": "SetAttribute",
      "attribute": "cardiac_surgery",
      "value": "cabg",
      "direct_transition": "Assign CARE Score"
    },
    "Assign CARE Score": {
      "type": "CallSubmodule",
      "submodule": "heart/care_score",
      "direct_transition": "Set Outcomes"
    },
    "Set Outcomes": {
      "type": "CallSubmodule",
      "submodule": "heart/cabg/outcomes",
      "direct_transition": "Referral_Procedure"
    },
    "Referral": {
      "type": "CallSubmodule",
      "submodule": "heart/cabg/referral",
      "direct_transition": "Terminal"
    },
    "Cardiac Encounter": {
      "type": "Encounter",
      "encounter_class": "ambulatory",
      "reason": "cardiac_surgery_reason",
      "codes": [
        {
          "system": "SNOMED-CT",
          "code": 185347001,
          "display": "Encounter for problem (procedure)"
        }
      ],
      "direct_transition": "CABG"
    },
    "Referral_Procedure": {
      "type": "Procedure",
      "codes": [
        {
          "system": "SNOMED-CT",
          "code": 183519002,
          "display": "Referral to cardiology service (procedure)"
        }
      ],
      "duration": {
        "low": 30,
        "high": 60,
        "unit": "minutes"
      },
      "reason": "cardiac_surgery_reason",
      "direct_transition": "End Cardiac Encounter"
    },
    "End Cardiac Encounter": {
      "type": "EncounterEnd",
      "conditional_transition": [
        {
          "transition": "Urgent",
          "condition": {
            "condition_type": "Attribute",
            "attribute": "care_score_e",
            "operator": "==",
            "value": true
          }
        },
        {
          "transition": "Non Urgent"
        }
      ]
    },
    "Urgent": {
      "type": "Delay",
      "direct_transition": "Referral",
      "range": {
        "low": 12,
        "high": 48,
        "unit": "hours"
      }
    },
    "Non Urgent": {
      "type": "Delay",
      "direct_transition": "Referral",
      "range": {
        "low": 1,
        "high": 7,
        "unit": "days"
      }
    },
    "Reason": {
      "type": "ConditionOnset",
      "assign_to_attribute": "cardiac_surgery_reason",
      "codes": [
        {
          "system": "SNOMED-CT",
          "code": 399211009,
          "display": "History of myocardial infarction (situation)"
        }
      ],
      "direct_transition": "Cardiac Encounter",
      "target_encounter": "Cardiac Encounter"
    }
  }
}